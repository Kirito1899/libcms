{% extends 'index/frontend/index.html' %}
{% load i18n %}
{% load participant_news_tags %}
{% load participant_events_tags %}
{#{% load ssearch_tags %}#}
{#{% load news_tags %}#}
{#{% load events_tags %}#}
{#{% load ssearch_tags %}#}
{#{% load participiants_tags %}#}
{#{% load cache %}#}
{% get_current_language as LANGUAGE_CODE %}
{% block title %}{{ library.name }}{% endblock %}
{% block content %}
    <nav class="bg bg_second">
        <div class="container">
            {% include 'main_menu.html' %}
        </div>
    </nav>
    <main>
        <div class="container">
            <ul class="bread__crumbs">
                <li>
                    <a href="{% url 'index:frontend:index' %}" class="bread__crumbs_link">
                        Главная
                    </a>
                </li>
                {% for ancestor in ancestors %}
                    <li>
                        <img src="{{ STATIC_URL }}dist/images/br_crumbs.svg">
                    </li>
                    <li><a href="{% url 'participant_site:frontend:index' ancestor.code %}"
                           class="bread__crumbs_link">{{ ancestor.name }}</a></li>
                {% endfor %}
                <li>
                    <img src="{{ STATIC_URL }}dist/images/br_crumbs.svg">
                </li>
                <li>
                    <a class="bread__crumbs_link bread__crumbs_link_active">
                        {{ library.name }}
                    </a>
                </li>
            </ul>
        </div>
        <hr class="footer-hr">
        <div class="container content-page">
            <div class="row">
                <div class="col-8">
                    <h1 class="content-page__title">{{ library.name }}</h1>

                    <div id="map-lib-item" class="map">
                    </div>
                    <div class="content-page__text">
                        <p><strong>Сайт:</strong>
                            {% if library.http_service %}
                                <a target="_blank"
                                   href="{{ library.http_service }}">{{ library.http_service }}</a>
                            {% else %}
                                {% url 'participant_site:frontend:index' library.code as library_site_address %}
                                <a href="http://{{ request.META.HTTP_HOST }}{{ library_site_address }}">http://{{ request.META.HTTP_HOST }}{{ library_site_address }}</a>
                            {% endif %}
                        </p>

                        <p><strong>E-mail:</strong> <a
                                href="mailto:{{ library.mail|lower }}">{{ library.mail|lower }}</a></p>

                        <p><strong>Адрес:</strong> {{ library.postal_address|default:'не указан' }}</p>

                        <p><strong>Телефон:</strong> {{ library.phone|default:'не указан' }}</p>
                    </div>

                    <h1 class="content-page__title">Новости библиотеки <a
                            href="{% url 'participant_news:frontend:index' library.code %}" class="news-box__all"
                            title="Посмотреть архив новостей">Архив новостей</a></h1>

                    {% participant_news_feed library.id '4' %}

{#                    <h1 class="content-page__title">Последние поступления в библиотеку</h1>#}
{##}
{#                    {% participant_income library.code %}#}

                </div>
                <div class="col-4">
                    <div class="facets-container">
                        <div class="facets-container__item">
                            <div class="facet">
                                <div class="facet__header">
                                    <h4 class="facet__title">Информация</h4>
                                </div>
                                <div class="facet__body">
                                    {% include 'participant_site/frontend/site_menu.html' %}
                                </div>
                            </div>
                        </div>
                        <div class="facets-container__item">
                            <div class="facet">
                                <div class="facet__header">
                                    <h4 class="facet__title">Афиша</h4>
                                </div>
                                <div class="">
                                    <div class="poster-box">
                                        <a href="{% url 'participant_events:frontend:subscribe' library.code %}"
                                           class="poster-box__all poster-box__all_margin">
                                            Подписаться на события библиотеки</a>
                                        <br><br>
                                        <a href="{% url 'participant_events:frontend:index' library.code %}"
                                           class="poster-box__all poster-box__all_margin"
                                           title="Посмотреть все мероприятия">Все мероприятия</a>
                                        {% participant_events_nearest library.id '5' %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="facets-container__item">
                            <div class="facet">
                                <div class="facet__header">
                                    <h4 class="facet__title">Календарь событий</h4>
                                </div>
                                <div class="facet__body">
                                    <a href="{% url 'participant_events:frontend:index' library.code %}"
                                       class="poster-box__all">
                                        Другие события</a>
                                    {% participant_events_calendar library %}

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>
    <script type="text/javascript">
        ymaps.ready(init);
        var myMap;
        var coords = [{{ library.latitude|safe|default:'0.0' }}, {{ library.longitude|safe|default:'0.0' }}];
        function init() {
            orgMap = new ymaps.Map($('.map')[0], {
                center: coords,
                zoom: 12
            });
            orgPlacemark = new ymaps.Placemark(
                    coords,
                    {
                        content: '{{ library.name }}',
                        balloonContent: '<p>Адрес: {{ library.postal_address|linebreaks|default:'не указан' }}</p>'
                    }
            );
            orgMap.geoObjects.add(orgPlacemark);
        }
    </script>

    <script type="text/javascript">
        var yaParams = {
            orgsSite: '{{ library.code }}'
        };
    </script>

    <script type="text/javascript">
        (function (d, w, c) {
            (w[c] = w[c] || []).push(function () {
                try {
                    w.yaCounter28398531 = new Ya.Metrika({
                        id: 28398531,
                        clickmap: true,
                        trackLinks: true,
                        accurateTrackBounce: true, params: window.yaParams || {}
                    });
                } catch (e) {
                }
            });

            var n = d.getElementsByTagName("script")[0],
                    s = d.createElement("script"),
                    f = function () {
                        n.parentNode.insertBefore(s, n);
                    };
            s.type = "text/javascript";
            s.async = true;
            s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";

            if (w.opera == "[object Opera]") {
                d.addEventListener("DOMContentLoaded", f, false);
            } else {
                f();
            }
        })(document, window, "yandex_metrika_callbacks");
    </script>
{% endblock %}
